import{u as F,g as q,r as g,o as A,a as G,n as W,d as T,b,c as I,e as D,f as i,h as o,i as C,w as R,j as U,k as w,s as J,l as V,t as x,A as S,m as H,p as K,_ as P,q as Q,v as X,x as Y,y as Z,z as O,B as ee,F as ae,C as te,D as ne,E as se,G as oe,H as z,I as le}from"./index-2494d58d.js";function ce(){const{appData:d}=F();return{upload:async s=>{const a={fileId:q(),fileName:s.name,filePath:URL.createObjectURL(s),createDate:Date.now()};return d.value.imageResources.unshift(a),a},search:async(s,a)=>{const e=d.value.imageResources,n=e.length,l=(s-1)*a,_=e.slice(l,l+a);return{total:n,result:_}},searchNext:async(s,a="",e)=>{var f;let n=d.value.imageResources.filter(m=>e!=null&&e.keyword?m.fileName.toUpperCase().indexOf(e.keyword.toUpperCase())>-1:!0);if(a){const m=n.findIndex(k=>k.fileId===a);m>-1&&(n=n.slice(m))}const l=n.slice(0,s),_=(f=n[s])==null?void 0:f.fileId;return{result:l,nextId:_}},remove:async s=>{const a=d.value.imageResources,e=a.findIndex(n=>n.fileId===s);e>-1&&a.splice(e,1)}}}function re(d,h,r,u){const c=g(""),s=g([]),a=g(!1),e=g(!0),n=g(!1);let l=null;const _=()=>(l||(l=r()),l),f=async(p=u==null?void 0:u())=>{if(n.value||a.value)return;a.value=!0;const y=await d(h,c.value,p);s.value.push(...y.result),c.value=y.nextId,a.value=!1,y.nextId||(n.value=!0)},m=async()=>{e.value=!0;const p=_();for(;await f(),await W(),!(n.value||p.scrollHeight>p.offsetHeight););e.value=!1},k=()=>{const{scrollTop:p,scrollHeight:y,offsetHeight:N}=_();p+N===y&&f()};return A(()=>{_().addEventListener("scroll",k)}),G(()=>{_().removeEventListener("scroll",k)}),{nextId:c,data:s,loadNext:f,loading:a,initLoad:m,initLoading:e,resetStates:()=>{c.value="",s.value=[],a.value=!1,e.value=!1,n.value=!1}}}const ie=["src"],de=T({__name:"AppImageCard",props:{data:{},pickerMode:{type:Boolean}},emits:["delete","select"],setup(d,{emit:h}){const r=d,u=h,c=()=>{H(K(r.data.filePath),{successMsg:"复制成功",errorMsg:"复制失败：{e}"})},s=()=>{u("delete")},a=()=>{u("select")};return(e,n)=>{const l=b("el-button");return I(),D("div",{class:o(e.$style.card)},[i("div",{class:o(e.$style.card_img)},[i("img",{src:e.data.filePath},null,8,ie),e.pickerMode?(I(),D("div",{key:0,class:o(e.$style.card_pick)},[C(l,{class:o(e.$style.card_pick_action),icon:w(J),type:"primary",onClick:a},{default:R(()=>[U(" 使用素材 ")]),_:1},8,["class","icon"])],2)):V("",!0)],2),i("div",{class:o(e.$style.card_footer)},[i("div",{class:o(e.$style.card_name)},x(e.data.fileName),3),i("div",{class:o(e.$style.card_footer_right)},[C(S,{icon:"copy",title:"点击复制图片链接","hover-active":!0,placement:"top",onClick:c}),C(S,{icon:"delete",title:"删除","hover-active":!0,placement:"top",theme:"danger",onClick:s})],2)],2)],2)}}}),_e="_card_1rg4o_1",pe="_card_img_1rg4o_8",ue="_card_footer_1rg4o_20",fe="_card_footer_right_1rg4o_27",me="_card_name_1rg4o_33",ve="_card_pick_1rg4o_41",ge="_card_pick_action_1rg4o_51",ye={card:_e,card_img:pe,card_footer:ue,card_footer_right:fe,card_name:me,card_pick:ve,card_pick_action:ge},he={$style:ye},ke=P(de,[["__cssModules",he]]),$e=T({__name:"AppMaterialImage",props:{sizeLimit:{default:"2MB"},typeLimit:{default:()=>["png","jpg","gif","svg"]},hooks:{type:Function,default:ce},inDialog:{type:Boolean},pickerMode:{type:Boolean},onSelect:{}},emits:["select"],setup(d,{emit:h}){const r=d,u=h,c=g(""),{searchNext:s,upload:a,remove:e}=r.hooks(),n=g(null),{data:l,initLoading:_,initLoad:f,resetStates:m}=re(s,10,()=>n.value.wrapRef,()=>({keyword:c.value})),k=Q(()=>`请上传大小在${r.sizeLimit}以内的${r.typeLimit.join("、")}文件，支持批量上传`);A(async()=>{await f()}),X(c,()=>{m(),f()});const E=g(!1),p=async()=>{oe({multiple:!0,limitSize:r.sizeLimit,limitType:r.typeLimit,onTypeError:()=>z.error("不支持该类型"),onSizeError:()=>z.error(`图片大小超出${r.sizeLimit}`)}).then(async t=>{E.value=!0;try{return await t.reduce(async($,L)=>{await $;const M=await a(L);l.value.unshift(M)},Promise.resolve())}finally{E.value=!1}}).catch(()=>0)},y=t=>{le.confirm("删除后，所有使用该素材的组件将显示异常",{title:"确定要删除素材？",type:"warning",beforeClose:async($,L,M)=>{$==="confirm"&&(L.confirmButtonLoading=!0,await H(e(t.fileId),{errorMsg:"删除失败：{e}"}).then(()=>{const B=l.value.findIndex(v=>v.fileId===t.fileId);B>-1&&l.value.splice(B,1)})),M()}})},N=t=>{u("select",t)};return(t,$)=>{const L=b("el-button"),M=b("el-input"),B=Y("loading");return I(),D("div",{class:o([t.$style.panel,t.inDialog&&t.$style.in_dialog])},[i("div",{class:o(t.$style.panel_header)},[i("div",{class:o(t.$style.panel_action)},[C(L,{type:"primary",icon:w(Z),onClick:p},{default:R(()=>[U(" 上传图片 ")]),_:1},8,["icon"]),i("span",{class:o(t.$style.panel_action_tip)},x(k.value),3)],2),i("div",{class:o(t.$style.panel_search)},[C(M,{"prefix-icon":w(O),placeholder:"输入关键词搜索",modelValue:c.value,"onUpdate:modelValue":$[0]||($[0]=v=>c.value=v)},null,8,["prefix-icon","modelValue"])],2)],2),i("div",{class:o(t.$style.panel_content)},[w(_)||E.value?ee((I(),D("div",{key:0,class:o([t.$style.panel_content_mask,t.$style.is_uploading])},null,2)),[[B,!0]]):V("",!0),C(w(se),{class:o(t.$style.panel_content_scroll),ref_key:"scrollRef",ref:n},{default:R(()=>[i("div",{class:o(t.$style.panel_images)},[(I(!0),D(ae,null,te(w(l),v=>(I(),ne(ke,{key:v.fileId,data:v,"picker-mode":t.pickerMode,onDelete:j=>y(v),onSelect:j=>N(v)},null,8,["data","picker-mode","onDelete","onSelect"]))),128))],2)]),_:1},8,["class"])],2)],2)}}}),we="_panel_11r9o_1",Ie="_in_dialog_11r9o_9",Ce="_panel_header_11r9o_12",Le="_panel_content_11r9o_19",Me="_panel_content_scroll_11r9o_26",De="_panel_content_mask_11r9o_26",Ee="_is_uploading_11r9o_37",Be="_panel_action_11r9o_40",Ne="_panel_action_tip_11r9o_44",be="_panel_search_11r9o_48",Re="_panel_images_11r9o_53",Se={panel:we,in_dialog:Ie,panel_header:Ce,panel_content:Le,panel_content_scroll:Me,panel_content_mask:De,is_uploading:Ee,panel_action:Be,panel_action_tip:Ne,panel_search:be,panel_images:Re},ze={$style:Se},Te=P($e,[["__cssModules",ze]]);export{Te as default};
