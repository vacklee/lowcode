import{y as j,z as G,i as g,B as T,D as J,E as K,d as U,r as R,o as I,c as D,a as i,n as o,b as L,w as S,e as V,G as w,H as Q,l as A,t as P,x as b,I as x,J as W,_ as H,f as q,K as X,L as Y,M as Z,N as O,O as ee,F as ae,k as te,h as ne,P as se,Q as oe,R as z,S as le}from"./index-619e6e2b.js";function ce(){const{appData:d}=j();return{upload:async s=>{const a={fileId:G(),fileName:s.name,filePath:URL.createObjectURL(s),createDate:Date.now()};return d.value.imageResources.unshift(a),a},search:async(s,a)=>{const e=d.value.imageResources,n=e.length,l=(s-1)*a,_=e.slice(l,l+a);return{total:n,result:_}},searchNext:async(s,a="",e)=>{var f;let n=d.value.imageResources.filter(m=>e!=null&&e.keyword?m.fileName.toUpperCase().indexOf(e.keyword.toUpperCase())>-1:!0);if(a){const m=n.findIndex(k=>k.fileId===a);m>-1&&(n=n.slice(m))}const l=n.slice(0,s),_=(f=n[s])==null?void 0:f.fileId;return{result:l,nextId:_}},remove:async s=>{const a=d.value.imageResources,e=a.findIndex(n=>n.fileId===s);e>-1&&a.splice(e,1)}}}function re(d,h,r,u){const c=g(""),s=g([]),a=g(!1),e=g(!0),n=g(!1);let l=null;const _=()=>(l||(l=r()),l),f=async(p=u==null?void 0:u())=>{if(n.value||a.value)return;a.value=!0;const y=await d(h,c.value,p);s.value.push(...y.result),c.value=y.nextId,a.value=!1,y.nextId||(n.value=!0)},m=async()=>{e.value=!0;const p=_();for(;await f(),await K(),!(n.value||p.scrollHeight>p.offsetHeight););e.value=!1},k=()=>{const{scrollTop:p,scrollHeight:y,offsetHeight:B}=_();p+B===y&&f()};return T(()=>{_().addEventListener("scroll",k)}),J(()=>{_().removeEventListener("scroll",k)}),{nextId:c,data:s,loadNext:f,loading:a,initLoad:m,initLoading:e,resetStates:()=>{c.value="",s.value=[],a.value=!1,e.value=!1,n.value=!1}}}const ie=["src"],de=U({__name:"AppImageCard",props:{data:{},pickerMode:{type:Boolean}},emits:["delete","select"],setup(d,{emit:h}){const r=d,u=h,c=()=>{x(W(r.data.filePath),{successMsg:"复制成功",errorMsg:"复制失败：{e}"})},s=()=>{u("delete")},a=()=>{u("select")};return(e,n)=>{const l=R("el-button");return I(),D("div",{class:o(e.$style.card)},[i("div",{class:o(e.$style.card_img)},[i("img",{src:e.data.filePath},null,8,ie),e.pickerMode?(I(),D("div",{key:0,class:o(e.$style.card_pick)},[L(l,{class:o(e.$style.card_pick_action),icon:w(Q),type:"primary",onClick:a},{default:S(()=>[V(" 使用素材 ")]),_:1},8,["class","icon"])],2)):A("",!0)],2),i("div",{class:o(e.$style.card_footer)},[i("div",{class:o(e.$style.card_name)},P(e.data.fileName),3),i("div",{class:o(e.$style.card_footer_right)},[L(b,{icon:"copy",title:"点击复制图片链接","hover-active":!0,placement:"top",onClick:c}),L(b,{icon:"delete",title:"删除","hover-active":!0,placement:"top",theme:"danger",onClick:s})],2)],2)],2)}}}),_e="_card_1rg4o_1",pe="_card_img_1rg4o_8",ue="_card_footer_1rg4o_20",fe="_card_footer_right_1rg4o_27",me="_card_name_1rg4o_33",ve="_card_pick_1rg4o_41",ge="_card_pick_action_1rg4o_51",ye={card:_e,card_img:pe,card_footer:ue,card_footer_right:fe,card_name:me,card_pick:ve,card_pick_action:ge},he={$style:ye},ke=H(de,[["__cssModules",he]]),$e=U({__name:"AppMaterialImage",props:{sizeLimit:{default:"2MB"},typeLimit:{default:()=>["png","jpg","gif","svg"]},hooks:{type:Function,default:ce},inDialog:{type:Boolean},pickerMode:{type:Boolean},onSelect:{}},emits:["select"],setup(d,{emit:h}){const r=d,u=h,c=g(""),{searchNext:s,upload:a,remove:e}=r.hooks(),n=g(null),{data:l,initLoading:_,initLoad:f,resetStates:m}=re(s,10,()=>n.value.wrapRef,()=>({keyword:c.value})),k=q(()=>`请上传大小在${r.sizeLimit}以内的${r.typeLimit.join("、")}文件，支持批量上传`);T(async()=>{await f()}),X(c,()=>{m(),f()});const E=g(!1),p=async()=>{oe({multiple:!0,limitSize:r.sizeLimit,limitType:r.typeLimit,onTypeError:()=>z.error("不支持该类型"),onSizeError:()=>z.error(`图片大小超出${r.sizeLimit}`)}).then(async t=>{E.value=!0;try{return await t.reduce(async($,M)=>{await $;const C=await a(M);l.value.unshift(C)},Promise.resolve())}finally{E.value=!1}}).catch(()=>0)},y=t=>{le.confirm("删除后，所有使用该素材的组件将显示异常",{title:"确定要删除素材？",type:"warning",beforeClose:async($,M,C)=>{$==="confirm"&&(M.confirmButtonLoading=!0,await x(e(t.fileId),{errorMsg:"删除失败：{e}"}).then(()=>{const N=l.value.findIndex(v=>v.fileId===t.fileId);N>-1&&l.value.splice(N,1)})),C()}})},B=t=>{u("select",t)};return(t,$)=>{const M=R("el-button"),C=R("el-input"),N=Y("loading");return I(),D("div",{class:o([t.$style.panel,t.inDialog&&t.$style.in_dialog])},[i("div",{class:o(t.$style.panel_header)},[i("div",{class:o(t.$style.panel_action)},[L(M,{type:"primary",icon:w(Z),onClick:p},{default:S(()=>[V(" 上传图片 ")]),_:1},8,["icon"]),i("span",{class:o(t.$style.panel_action_tip)},P(k.value),3)],2),i("div",{class:o(t.$style.panel_search)},[L(C,{"prefix-icon":w(O),placeholder:"输入关键词搜索",modelValue:c.value,"onUpdate:modelValue":$[0]||($[0]=v=>c.value=v)},null,8,["prefix-icon","modelValue"])],2)],2),i("div",{class:o(t.$style.panel_content)},[w(_)||E.value?ee((I(),D("div",{key:0,class:o([t.$style.panel_content_mask,t.$style.is_uploading])},null,2)),[[N,!0]]):A("",!0),L(w(se),{class:o(t.$style.panel_content_scroll),ref_key:"scrollRef",ref:n},{default:S(()=>[i("div",{class:o(t.$style.panel_images)},[(I(!0),D(ae,null,te(w(l),v=>(I(),ne(ke,{key:v.fileId,data:v,"picker-mode":t.pickerMode,onDelete:F=>y(v),onSelect:F=>B(v)},null,8,["data","picker-mode","onDelete","onSelect"]))),128))],2)]),_:1},8,["class"])],2)],2)}}}),we="_panel_11r9o_1",Ie="_in_dialog_11r9o_9",Le="_panel_header_11r9o_12",Me="_panel_content_11r9o_19",Ce="_panel_content_scroll_11r9o_26",De="_panel_content_mask_11r9o_26",Ee="_is_uploading_11r9o_37",Ne="_panel_action_11r9o_40",Be="_panel_action_tip_11r9o_44",Re="_panel_search_11r9o_48",Se="_panel_images_11r9o_53",be={panel:we,in_dialog:Ie,panel_header:Le,panel_content:Me,panel_content_scroll:Ce,panel_content_mask:De,is_uploading:Ee,panel_action:Ne,panel_action_tip:Be,panel_search:Re,panel_images:Se},ze={$style:be},Ue=H($e,[["__cssModules",ze]]);export{Ue as default};
